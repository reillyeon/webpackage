<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Subresource Loading with Web Bundles</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version fb1e763a4, updated Tue Mar 1 13:13:50 2022 -0800" name="generator">
  <link href="https://wicg.github.io/webpackage/subresource-loading.html" rel="canonical">
  <meta content="aef4300806df29012b3d744d958fcdd278e9fa46" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Subresource Loading with Web Bundles</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2022-03-07">7 March 2022</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/webpackage/subresource-loading.html">https://wicg.github.io/webpackage/subresource-loading.html</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/webpackage/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:hayato@google.com">Hayato Ito</a> (<a class="p-org org" href="https://google.com/">Google Inc.</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 the Contributors to the Subresource Loading with Web Bundles Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>How UAs load subresources from Web Bundles.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#structures"><span class="secno">2</span> <span class="content">Structures</span></a>
    <li><a href="#html-monkeypatches"><span class="secno">3</span> <span class="content">HTML monkeypatches</span></a>
    <li>
     <a href="#fetch-monkeypatches"><span class="secno">4</span> <span class="content">Fetch monkeypatches</span></a>
     <ol class="toc">
      <li><a href="#monkeypatch-http-network-or-cache-fetch"><span class="secno">4.1</span> <span class="content">Monkeypatch HTTP-network-or-cache fetch</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">5</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#fetch-web-bundle"><span class="secno">5.1</span> <span class="content">Fetch web bundle</span></a>
      <li><a href="#fetch-from-web-bundle"><span class="secno">5.2</span> <span class="content">Fetch from web bundle</span></a>
      <li><a href="#match-url-with-web-bundle"><span class="secno">5.3</span> <span class="content">Match url with web bundle</span></a>
      <li><a href="#get-response-from-web-bundle"><span class="secno">5.4</span> <span class="content">Get response from web bundle</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>The Subresource Loading with Web Bundles specification describes a way to load a
large number of resources efficiently using a format that allows multiple
resources to be bundled, <a href="https://web.dev/web-bundles/">Web Bundles</a>. This
specification describes how web browsers load those resources. It is expressed
as several monkeypatches to the <a data-link-type="biblio" href="#biblio-html">[HTML]</a> and <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a> specification which call
algorithms defined here.</p>
   <p class="note" role="note"><span>Note:</span> This specification is under construction. See <a href="https://github.com/WICG/webpackage/issues/708">#708</a>.</p>
   <h2 class="heading settled" data-level="2" id="structures"><span class="secno">2. </span><span class="content">Structures</span><a class="self-link" href="#structures"></a></h2>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fetched-web-bundle">fetched web bundle</dfn> is a representation of a web bundle format
defined in <a data-link-type="biblio" href="#biblio-draft-ietf-wpack-bundled-responses-latest">[draft-ietf-wpack-bundled-responses-latest]</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bundle-rule">bundle rule</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">items</a>:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="bundle rule" data-dfn-type="dfn" data-noexport id="bundle-rule-source">source</dfn>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="bundle rule" data-dfn-type="dfn" data-noexport id="bundle-rule-credentials">credentials</dfn>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode">mode</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="bundle rule" data-dfn-type="dfn" data-noexport id="bundle-rule-resources">resources</dfn>, a list of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URLs</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="bundle rule" data-dfn-type="dfn" data-noexport id="bundle-rule-scopes">scopes</dfn>, a list of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URLs</a>.</p>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="web-bundle">web bundle</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> with the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item①">items</a>:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="web bundle" data-dfn-type="dfn" data-noexport id="web-bundle-fetched-bundle">fetched bundle</dfn>, a <a data-link-type="dfn" href="#fetched-web-bundle" id="ref-for-fetched-web-bundle">fetched web bundle</a> or null.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="web bundle" data-dfn-type="dfn" data-noexport id="web-bundle-rule">rule</dfn>, a <a data-link-type="dfn" href="#bundle-rule" id="ref-for-bundle-rule">bundle rule</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="web bundle" data-dfn-type="dfn" data-noexport id="web-bundle-state">state</dfn>, an internal state which is "fetching",
"fetched", or "failed". Initially "fetching".</p>
   </ul>
   <p>A <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> has a <dfn class="dfn-paneled" data-dfn-for="document" data-dfn-type="dfn" data-noexport id="document-web-bundle-list">web bundle list</dfn>, which is a list of <a data-link-type="dfn" href="#web-bundle" id="ref-for-web-bundle">web bundles</a>.</p>
   <h2 class="heading settled" data-level="3" id="html-monkeypatches"><span class="secno">3. </span><span class="content">HTML monkeypatches</span><a class="self-link" href="#html-monkeypatches"></a></h2>
   <p class="note" role="note"><span>Note:</span> TODO. This section uses <a data-link-type="dfn" href="#concept-fetch-web-bundle" id="ref-for-concept-fetch-web-bundle">fetch web bundle</a>.</p>
   <h2 class="heading settled" data-level="4" id="fetch-monkeypatches"><span class="secno">4. </span><span class="content">Fetch monkeypatches</span><a class="self-link" href="#fetch-monkeypatches"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="monkeypatch-http-network-or-cache-fetch"><span class="secno">4.1. </span><span class="content">Monkeypatch HTTP-network-or-cache fetch</span><a class="self-link" href="#monkeypatch-http-network-or-cache-fetch"></a></h3>
   <p>In <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" id="ref-for-concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a>, before</p>
   <blockquote>
    <p>8.22. Set httpCache to the result of determining the HTTP cache partition,
given <var>httpRequest</var>.</p>
   </blockquote>
   <p>add the following steps:</p>
   <ol start="22">
    <li data-md>
     <p>Set the <var>response</var> to the result of <a data-link-type="dfn" href="#concept-fetch-from-web-bundle" id="ref-for-concept-fetch-from-web-bundle">fetch from web bundle</a>, given <var>httpRequest</var>.</p>
     <ol>
      <li data-md>
       <p>If <var>response</var> is <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a>, return <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error①">network error</a>.</p>
      <li data-md>
       <p>If <var>response</var> is non-null, skip the steps 8.22-8.24 and goto the step 9.</p>
       <p class="note" role="note"><span>Note:</span> That means a subresource from a webbundle never interacts with
 HttpCache. We plan to support HttpCache as a feature enhancement in the
 future.</p>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="5" id="algorithms"><span class="secno">5. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="fetch-web-bundle"><span class="secno">5.1. </span><span class="content">Fetch web bundle</span><a class="self-link" href="#fetch-web-bundle"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="concept-fetch-web-bundle">fetch web bundle</dfn> given <a data-link-type="dfn" href="#web-bundle" id="ref-for-web-bundle①">web
bundle</a> <var>web bundle</var> and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetch-params" id="ref-for-fetch-params">fetch params</a> <var>fetch params</var>:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-state" id="ref-for-web-bundle-state">state</a> is "fetching".</p>
    <li data-md>
     <p>Let <var>request</var> be <var>fetch params</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a>.</p>
    <li data-md>
     <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a> to <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-rule" id="ref-for-web-bundle-rule">rule</a>'s <a data-link-type="dfn" href="#bundle-rule-source" id="ref-for-bundle-rule-source">source</a>.</p>
     <p class="note" role="note"><span>Note:</span> Source URL is resolved on document’s base URL.</p>
    <li data-md>
     <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination">destination</a> to "webbundle",</p>
    <li data-md>
     <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode①">mode</a> to "cors",</p>
    <li data-md>
     <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode">credentials mode</a> to <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-rule" id="ref-for-web-bundle-rule①">rule</a>'s <a data-link-type="dfn" href="#bundle-rule-credentials" id="ref-for-bundle-rule-credentials">credentials</a>.</p>
    <li data-md>
     <p>Append a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header">header</a>, a tuple of ("Accept", "application/webbundle;v=b2"), to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>.</p>
     <p class="note" role="note"><span>Note:</span> The final <a data-link-type="biblio" href="#biblio-draft-ietf-wpack-bundled-responses-latest">[draft-ietf-wpack-bundled-responses-latest]</a> will use a
 version of <code>1</code>, but this specification tracks what’s actually implemented in
 browsers, which still uses draft versions.</p>
    <li data-md>
     <p>Let <var>response</var> be the result of running <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" id="ref-for-concept-http-network-or-cache-fetch①">HTTP-network-or-cache
 fetch</a> given <var>fetch params</var>.</p>
     <p class="note" role="note"><span>Note:</span> Chromium’s current implementation doesn’t allow a <em>nested bundle</em>. A
 Web bundle is never fetched from other web bundles.</p>
    <li data-md>
     <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is 200,</p>
     <ol>
      <li data-md>
       <p>Set <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-fetched-bundle" id="ref-for-web-bundle-fetched-bundle">fetched bundle</a> to the result of parsing <var>response</var>’s body (<a data-link-type="biblio" href="#biblio-draft-ietf-wpack-bundled-responses-latest">[draft-ietf-wpack-bundled-responses-latest]</a>) and <var>web
  bundle</var>’s <a data-link-type="dfn" href="#web-bundle-state" id="ref-for-web-bundle-state①">state</a> be "fetched". If parsing fails, or any
  other conformance is violated, set <a data-link-type="dfn" href="#web-bundle-fetched-bundle" id="ref-for-web-bundle-fetched-bundle①">fetched bundle</a> to null
  and <a data-link-type="dfn" href="#web-bundle-state" id="ref-for-web-bundle-state②">state</a> to "failed".</p>
       <p class="note" role="note"><span>Note:</span> In parsing, Chromium’s experimental implementation only accepts "b2"
  as a web bundle format version number
  (<a data-link-type="biblio" href="#biblio-draft-ietf-wpack-bundled-responses-latest">[draft-ietf-wpack-bundled-responses-latest]</a>).</p>
     </ol>
    <li data-md>
     <p>Otherwise, set <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-state" id="ref-for-web-bundle-state③">state</a> to "failed".</p>
   </ol>
   <h3 class="heading settled" data-level="5.2" id="fetch-from-web-bundle"><span class="secno">5.2. </span><span class="content">Fetch from web bundle</span><a class="self-link" href="#fetch-from-web-bundle"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="concept-fetch-from-web-bundle">fetch from web bundle</dfn> given <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> <var>httpRequest</var>:</p>
   <ol>
    <li data-md>
     <p>For each <var>web bundle</var> of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a>'s <a data-link-type="dfn" href="#document-web-bundle-list" id="ref-for-document-web-bundle-list">web bundle list</a>:</p>
     <ol>
      <li data-md>
       <p>If the result of running <a data-link-type="dfn" href="#concept-match-url-with-web-bundle" id="ref-for-concept-match-url-with-web-bundle">match url with web bundle</a> given <var>httpRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①">url</a> and <var>web bundle</var> is true:</p>
       <ol>
        <li data-md>
         <p>Let <var>response</var> be the result of <a data-link-type="dfn" href="#concept-get-response-from-web-bundle" id="ref-for-concept-get-response-from-web-bundle">get response from web bundle</a> given <var>httpRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url②">url</a> and <var>web bundle</var>.</p>
        <li data-md>
         <p>If <var>response</var> is null, return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error②">network error</a>.</p>
         <p class="note" role="note"><span>Note:</span> This means a browser does not fallback to fetch a subresource
 from network.</p>
        <li data-md>
         <p>Otherwise, return <var>response</var>.</p>
       </ol>
     </ol>
    <li data-md>
     <p>Return null.</p>
   </ol>
   <h3 class="heading settled" data-level="5.3" id="match-url-with-web-bundle"><span class="secno">5.3. </span><span class="content">Match url with web bundle</span><a class="self-link" href="#match-url-with-web-bundle"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="concept-match-url-with-web-bundle">match url with web bundle</dfn> given <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">url</a> <var>url</var> and <a data-link-type="dfn" href="#web-bundle" id="ref-for-web-bundle②">web bundle</a> <var>web bundle</var>:</p>
   <ol>
    <li data-md>
     <p>If <var>url</var> doesn’t meet a path restriction rule, given <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-rule" id="ref-for-web-bundle-rule②">rule</a>'s <a data-link-type="dfn" href="#bundle-rule-source" id="ref-for-bundle-rule-source①">source</a>, then return false.</p>
     <p class="issue" id="issue-3afe47ae"><a class="self-link" href="#issue-3afe47ae"></a> Clarify path restriction rule in algorithm.</p>
    <li data-md>
     <p>If <var>url</var> matches any of <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-rule" id="ref-for-web-bundle-rule③">rule</a>'s <a data-link-type="dfn" href="#bundle-rule-resources" id="ref-for-bundle-rule-resources">resources</a>, then return true.</p>
    <li data-md>
     <p>If <var>url</var>’s prefix matches any of <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-rule" id="ref-for-web-bundle-rule④">rule</a>'s <a data-link-type="dfn" href="#bundle-rule-scopes" id="ref-for-bundle-rule-scopes">scopes</a>, then return true.</p>
    <li data-md>
     <p>Otherwise, return false.</p>
   </ol>
   <h3 class="heading settled" data-level="5.4" id="get-response-from-web-bundle"><span class="secno">5.4. </span><span class="content">Get response from web bundle</span><a class="self-link" href="#get-response-from-web-bundle"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="get response from web bundle" data-noexport id="concept-get-response-from-web-bundle">get response from web
bundle</dfn> given <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url④">url</a> <var>url</var> and <a data-link-type="dfn" href="#web-bundle" id="ref-for-web-bundle③">web bundle</a> <var>web bundle</var>:</p>
   <ol>
    <li data-md>
     <p>If <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-state" id="ref-for-web-bundle-state④">state</a> is "fetching", await until <a data-link-type="dfn" href="#web-bundle-state" id="ref-for-web-bundle-state⑤">state</a> becomes "fetched" or "failed" asynchronously.</p>
    <li data-md>
     <p>If <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-state" id="ref-for-web-bundle-state⑥">state</a> is "failed", return null.</p>
    <li data-md>
     <p class="assertion">Assert: <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-fetched-bundle" id="ref-for-web-bundle-fetched-bundle②">fetched bundle</a> is non-null.</p>
    <li data-md>
     <p>Returns <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> from <var>web bundle</var>’s <a data-link-type="dfn" href="#web-bundle-fetched-bundle" id="ref-for-web-bundle-fetched-bundle③">fetched bundle</a> given <var>url</var> (<a data-link-type="biblio" href="#biblio-draft-ietf-wpack-bundled-responses-latest">[draft-ietf-wpack-bundled-responses-latest]</a>). If a representation of <var>url</var> is not found in <a data-link-type="dfn" href="#web-bundle-fetched-bundle" id="ref-for-web-bundle-fetched-bundle④">fetched bundle</a>, return null.</p>
   </ol>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#bundle-rule">bundle rule</a><span>, in § 2</span>
   <li><a href="#bundle-rule-credentials">credentials</a><span>, in § 2</span>
   <li><a href="#web-bundle-fetched-bundle">fetched bundle</a><span>, in § 2</span>
   <li><a href="#fetched-web-bundle">fetched web bundle</a><span>, in § 2</span>
   <li><a href="#concept-fetch-from-web-bundle">fetch from web bundle</a><span>, in § 5.2</span>
   <li><a href="#concept-fetch-web-bundle">fetch web bundle</a><span>, in § 5.1</span>
   <li><a href="#concept-get-response-from-web-bundle">get response from web bundle</a><span>, in § 5.4</span>
   <li><a href="#concept-match-url-with-web-bundle">match url with web bundle</a><span>, in § 5.3</span>
   <li><a href="#bundle-rule-resources">resources</a><span>, in § 2</span>
   <li><a href="#web-bundle-rule">rule</a><span>, in § 2</span>
   <li><a href="#bundle-rule-scopes">scopes</a><span>, in § 2</span>
   <li><a href="#bundle-rule-source">source</a><span>, in § 2</span>
   <li><a href="#web-bundle-state">state</a><span>, in § 2</span>
   <li><a href="#web-bundle">web bundle</a><span>, in § 2</span>
   <li><a href="#document-web-bundle-list">web bundle list</a><span>, in § 2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-document">
   <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document">2. Structures</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document">5.2. Fetch from web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-credentials-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">https://fetch.spec.whatwg.org/#concept-request-credentials-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-credentials-mode">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-destination">
   <a href="https://fetch.spec.whatwg.org/#concept-request-destination">https://fetch.spec.whatwg.org/#concept-request-destination</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-destination">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fetch-params">
   <a href="https://fetch.spec.whatwg.org/#fetch-params">https://fetch.spec.whatwg.org/#fetch-params</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetch-params">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header">
   <a href="https://fetch.spec.whatwg.org/#concept-header">https://fetch.spec.whatwg.org/#concept-header</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-header-list">
   <a href="https://fetch.spec.whatwg.org/#concept-request-header-list">https://fetch.spec.whatwg.org/#concept-request-header-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-header-list">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-http-network-or-cache-fetch">
   <a href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch">https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-http-network-or-cache-fetch">4.1. Monkeypatch HTTP-network-or-cache fetch</a>
    <li><a href="#ref-for-concept-http-network-or-cache-fetch①">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-mode">https://fetch.spec.whatwg.org/#concept-request-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-mode">2. Structures</a>
    <li><a href="#ref-for-concept-request-mode①">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-network-error">
   <a href="https://fetch.spec.whatwg.org/#concept-network-error">https://fetch.spec.whatwg.org/#concept-network-error</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-network-error">4.1. Monkeypatch HTTP-network-or-cache fetch</a> <a href="#ref-for-concept-network-error①">(2)</a>
    <li><a href="#ref-for-concept-network-error②">5.2. Fetch from web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">5.1. Fetch web bundle</a>
    <li><a href="#ref-for-concept-request①">5.2. Fetch from web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response">
   <a href="https://fetch.spec.whatwg.org/#concept-response">https://fetch.spec.whatwg.org/#concept-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response">5.4. Get response from web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-status">
   <a href="https://fetch.spec.whatwg.org/#concept-response-status">https://fetch.spec.whatwg.org/#concept-response-status</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-status">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-url">https://fetch.spec.whatwg.org/#concept-request-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-url">5.1. Fetch web bundle</a>
    <li><a href="#ref-for-concept-request-url①">5.2. Fetch from web bundle</a> <a href="#ref-for-concept-request-url②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct-item">
   <a href="https://infra.spec.whatwg.org/#struct-item">https://infra.spec.whatwg.org/#struct-item</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct-item">2. Structures</a> <a href="#ref-for-struct-item①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct">
   <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct">2. Structures</a> <a href="#ref-for-struct①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">2. Structures</a> <a href="#ref-for-concept-url①">(2)</a> <a href="#ref-for-concept-url②">(3)</a>
    <li><a href="#ref-for-concept-url③">5.3. Match url with web bundle</a>
    <li><a href="#ref-for-concept-url④">5.4. Get response from web bundle</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-document">Document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-request-credentials-mode">credentials mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-destination">destination</span>
     <li><span class="dfn-paneled" id="term-for-fetch-params">fetch params</span>
     <li><span class="dfn-paneled" id="term-for-concept-header">header</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-header-list">header list</span>
     <li><span class="dfn-paneled" id="term-for-concept-http-network-or-cache-fetch">http-network-or-cache fetch</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-mode">mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-network-error">network error</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
     <li><span class="dfn-paneled" id="term-for-concept-response">response</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-status">status</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-url">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-struct-item">item</span>
     <li><span class="dfn-paneled" id="term-for-struct">struct</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url">url</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-draft-ietf-wpack-bundled-responses-latest">[DRAFT-IETF-WPACK-BUNDLED-RESPONSES-LATEST]
   <dd><a href="https://wpack-wg.github.io/bundled-responses/draft-ietf-wpack-bundled-responses.html"><cite>Web Bundles</cite></a>. URL: <a href="https://wpack-wg.github.io/bundled-responses/draft-ietf-wpack-bundled-responses.html">https://wpack-wg.github.io/bundled-responses/draft-ietf-wpack-bundled-responses.html</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Clarify path restriction rule in algorithm. <a class="issue-return" href="#issue-3afe47ae" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="fetched-web-bundle">
   <b><a href="#fetched-web-bundle">#fetched-web-bundle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetched-web-bundle">2. Structures</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bundle-rule">
   <b><a href="#bundle-rule">#bundle-rule</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bundle-rule">2. Structures</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bundle-rule-source">
   <b><a href="#bundle-rule-source">#bundle-rule-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bundle-rule-source">5.1. Fetch web bundle</a>
    <li><a href="#ref-for-bundle-rule-source①">5.3. Match url with web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bundle-rule-credentials">
   <b><a href="#bundle-rule-credentials">#bundle-rule-credentials</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bundle-rule-credentials">5.1. Fetch web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bundle-rule-resources">
   <b><a href="#bundle-rule-resources">#bundle-rule-resources</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bundle-rule-resources">5.3. Match url with web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bundle-rule-scopes">
   <b><a href="#bundle-rule-scopes">#bundle-rule-scopes</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bundle-rule-scopes">5.3. Match url with web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="web-bundle">
   <b><a href="#web-bundle">#web-bundle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-web-bundle">2. Structures</a>
    <li><a href="#ref-for-web-bundle①">5.1. Fetch web bundle</a>
    <li><a href="#ref-for-web-bundle②">5.3. Match url with web bundle</a>
    <li><a href="#ref-for-web-bundle③">5.4. Get response from web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="web-bundle-fetched-bundle">
   <b><a href="#web-bundle-fetched-bundle">#web-bundle-fetched-bundle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-web-bundle-fetched-bundle">5.1. Fetch web bundle</a> <a href="#ref-for-web-bundle-fetched-bundle①">(2)</a>
    <li><a href="#ref-for-web-bundle-fetched-bundle②">5.4. Get response from web bundle</a> <a href="#ref-for-web-bundle-fetched-bundle③">(2)</a> <a href="#ref-for-web-bundle-fetched-bundle④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="web-bundle-rule">
   <b><a href="#web-bundle-rule">#web-bundle-rule</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-web-bundle-rule">5.1. Fetch web bundle</a> <a href="#ref-for-web-bundle-rule①">(2)</a>
    <li><a href="#ref-for-web-bundle-rule②">5.3. Match url with web bundle</a> <a href="#ref-for-web-bundle-rule③">(2)</a> <a href="#ref-for-web-bundle-rule④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="web-bundle-state">
   <b><a href="#web-bundle-state">#web-bundle-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-web-bundle-state">5.1. Fetch web bundle</a> <a href="#ref-for-web-bundle-state①">(2)</a> <a href="#ref-for-web-bundle-state②">(3)</a> <a href="#ref-for-web-bundle-state③">(4)</a>
    <li><a href="#ref-for-web-bundle-state④">5.4. Get response from web bundle</a> <a href="#ref-for-web-bundle-state⑤">(2)</a> <a href="#ref-for-web-bundle-state⑥">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-web-bundle-list">
   <b><a href="#document-web-bundle-list">#document-web-bundle-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-web-bundle-list">5.2. Fetch from web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="concept-fetch-web-bundle">
   <b><a href="#concept-fetch-web-bundle">#concept-fetch-web-bundle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-fetch-web-bundle">3. HTML monkeypatches</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="concept-fetch-from-web-bundle">
   <b><a href="#concept-fetch-from-web-bundle">#concept-fetch-from-web-bundle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-fetch-from-web-bundle">4.1. Monkeypatch HTTP-network-or-cache fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="concept-match-url-with-web-bundle">
   <b><a href="#concept-match-url-with-web-bundle">#concept-match-url-with-web-bundle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-match-url-with-web-bundle">5.2. Fetch from web bundle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="concept-get-response-from-web-bundle">
   <b><a href="#concept-get-response-from-web-bundle">#concept-get-response-from-web-bundle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-get-response-from-web-bundle">5.2. Fetch from web bundle</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>